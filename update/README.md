**核心流程（两阶段）：**

**阶段一：初步需求解析与信息澄清**
1.  **用户初始构想输入**：用户通过自然语言提交其项目的初步设计构想。
2.  **初步问题分解与信息检索**：系统用AI模型对用户输入进行语义解析，将其分解为若干初步的搜索引擎查询。快速定位设计方向
2.  **AI信息摘要与澄清点识别**：AI对初步检索的信息进行分析与归纳，生成简要总结，并识别出对后续详细设计至关重要的模糊参数、关键决策点或信息缺口（例如，材料偏好、核心组件的具体型号、关键尺寸限制等）。系统将以结构化的数据格式（如JSON）输出此摘要及待澄清问题列表。
4.  **用户反馈输入**：用户针对AI提出的澄清问题提供明确的答复，用以精确化设计需求。

**阶段二：深度信息挖掘与详细规格制定**

1.  **针对性问题分解与深度信息检索**：基于已精确化的需求，AI生成新一轮更具针对性的搜索查询，并执行更广泛的在线信息检索，此阶段将获取更多数量的搜索结果（例如10条）以支持深度分析。
2.  **生成Text-to-CAD技术规格文档**：AI综合所有已收集的信息（包括用户初始构想、用户明确的反馈、以及两轮信息检索的结果），遵循预定义的、详尽的结构化模板，生成一份“Text-to-CAD设计规范”。此规范旨在详尽描述项目的名称、推荐材料、几何形态特征、关键组件的尺寸参数、装配方式等要素，为后续的CAD建模工作提供清晰、规范且具备可操作性的技术指导。



### 2. 主要代码模块功能说明

- **`config1.py` (配置)**：
  - 管理项目的全局配置，API密钥、服务URL、AI模型参数、搜索结果数量及日志设置，实现配置与逻辑分离。
  
- **`api_services.py` **：
  
  - 封装与外部API（DeerAPI进行AI文本处理，Serper API执行在线搜索）的通信。
  
- **`core_logic.py` (核心逻辑)**：
  
  - `decompose_question_with_gpt()`: 利用AI将用户输入分解为搜索引擎查询。
  - `generate_preliminary_summary_and_questions()`: 分析初步搜索结果，生成摘要并构建澄清问题。
  - `generate_report_with_gpt()`: 综合所有信息生成最终的Text-to-CAD设计规范。
  
- **`main.py` (主控制)**：

- `utils.py` **(通用工具模块)**： 提供通用辅助功能，如日志系统配置、目录管理及会话日志操作。

  

### 3. 系统运行

- 在项目根目录的命令行，执行 `python test.py` 。
- 程序将进行配置自检，然后进入两阶段交互流程：
  - **阶段一**：用户输入初步需求，AI提问以澄清。
  - **阶段二**：基于用户反馈，AI进行深度处理并生成最终规格。
- 最终的“Text-to-CAD设计规范”将输出至控制台。
- 详细运行日志记录于 `app.log` 及 `search_sessions` 目录下的会话日志。

### 4. 运行输出示例（关键环节）

```
--- STAGE 1: 初步研究与需求澄清 ---

请输入您的项目初步需求: 为我的无人机构建一个轻量化GPS支架

[S1 P1/3] 分析问题并生成初步搜索查询...
... (初步分解与搜索日志) ...
[S1 P3/3] 总结初步发现并生成澄清问题...

--- 初步研究摘要 ---
初步研究表明，无人机轻量化GPS支架常采用3D打印或碳纤维材料，并需考虑固定方式。

--- 请回答以下问题以细化设计需求 (可回车跳过) ---
  主要考虑材料 (如: 3D打印PLA/PETG, 碳纤维等)?
  您的回答: 3D Printed PLA/PETG
  关键部件有具体型号吗 (如GPS模块型号)?
  您的回答: [用户输入或留空]
  有无关键尺寸/安装点/环境约束?
  您的回答: [用户输入或留空]
  有无特定次要功能/外观风格需求?
  您的回答: [用户输入或留空]

--- STAGE 2: 详细研究与设计规格生成 ---

[S2 P1/3] 基于反馈生成更详细搜索查询...
... (详细分解与搜索日志) ...
[S2 P3/3] 整合信息并生成最终Text-to-CAD规格...

============================== 最终Text-to-CAD设计规格 ==============================
**Project Name:** 定制化轻量无人机GPS支架 (3D打印PLA/PETG)

**1. 基础组件与整体设计意图:**
    * **目标设备:** 无人机通用GPS模块
    * **支架类型:** 专为3D打印设计的轻量化安装支架
    * **主要目标:** PLA/PETG材料3D打印，安全固定GPS模块，优先轻量化并避免尖锐边角。

**2. 材料与构造:**
    * **主要材料:** 3D打印PLA或PETG (用户指定)
    * **壁厚/材料规格:** 通常2mm厚度。
    * **推荐颜色:** 材料本色。

... (其他详细规格) ...
=================================================================================
--- Test Execution Completed Successfully ---
Check 'app.log' for detailed logs.
```
